---
title: "Setting Up Local TLS Development Environment"
description: "Learn how to create a secure local development environment with TLS certificates and custom DNS routing"
date: "2024-03-21"
tags: ["development", "tls", "security", "devops"]
---

# Setting Up Local TLS Development Environment

As a developer working with modern web applications, you often need to test HTTPS endpoints locally. This guide will walk you through setting up a secure local development environment with TLS certificates and custom DNS routing.

## 1. Local TLS Certificates with mkcert

[mkcert](https://github.com/FiloSottile/mkcert) is a simple tool that makes locally-trusted development certificates. It automatically creates and installs a local CA (Certificate Authority) in your system and browser trust stores.

### Installation

#### macOS
```bash
brew install mkcert
```

#### Linux
```bash
sudo apt install libnss3-tools
sudo apt install mkcert
```

### Setting Up mkcert

1. First, install the local CA:
```bash
mkcert -install
```

2. Generate certificates for your local domains:
```bash
mkcert localhost
mkcert "*.test"
```

This will create two files:
- `localhost.pem` - The certificate file
- `localhost-key.pem` - The private key file

### Using the Certificates

You can now use these certificates in your development server. Here's an example using Node.js and Express:

```javascript
const https = require('https');
const express = require('express');
const fs = require('fs');

const app = express();
const options = {
  key: fs.readFileSync('localhost-key.pem'),
  cert: fs.readFileSync('localhost.pem')
};

https.createServer(options, app).listen(443, () => {
  console.log('HTTPS Server running on port 443');
});
```

## 2. Local DNS Configuration for *.test Domains

To route all *.test domains to localhost, we'll use dnsmasq, a lightweight DNS server.

### Installation

#### macOS
```bash
brew install dnsmasq
```

#### Linux
```bash
sudo apt install dnsmasq
```

### Configuration

1. Create a configuration file for dnsmasq:

```bash
# Create config directory if it doesn't exist
sudo mkdir -p /etc/dnsmasq.d

# Create the configuration file
echo "address=/test/127.0.0.1" | sudo tee /etc/dnsmasq.d/test.conf
```

2. Configure your system's DNS resolver:

#### macOS
Create or edit `/etc/resolv.conf`:
```
nameserver 127.0.0.1
```

#### Linux
Edit `/etc/resolv.conf`:
```
nameserver 127.0.0.1
```

3. Start dnsmasq service:

#### macOS
```bash
sudo brew services start dnsmasq
```

#### Linux
```bash
sudo systemctl start dnsmasq
sudo systemctl enable dnsmasq
```

### Testing the Setup

1. Test DNS resolution:
```bash
ping example.test
```

2. Test HTTPS with your certificates:
```bash
curl -k https://example.test
```

## Common Issues and Solutions

1. **Certificate not trusted**: Make sure you've run `mkcert -install` and restarted your browser.

2. **DNS not resolving**: 
   - Check if dnsmasq is running
   - Verify your resolv.conf configuration
   - Try flushing your DNS cache:
     ```bash
     sudo dscacheutil -flushcache; sudo killall -HUP mDNSResponder
     ```

3. **Port conflicts**: Ensure no other service is using port 443 on your machine.

## Security Considerations

- The certificates generated by mkcert are for development only and should never be used in production.
- The *.test domain setup is local to your machine and won't affect other systems.
- Always use proper security headers and follow security best practices even in development.

## Conclusion

Setting up a local TLS development environment with mkcert and dnsmasq provides a secure and convenient way to test HTTPS endpoints locally. This setup closely mirrors production environments while maintaining security and ease of use.

Remember to:
1. Keep your mkcert CA certificates secure
2. Regularly update your development tools
3. Follow security best practices even in development environments

Happy secure development! ðŸš€
